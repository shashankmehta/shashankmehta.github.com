<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    Backup plan on Ubuntu
  </title>
  <meta name="description" content="Personal website & blog">
  <!-- Set theme immediately to prevent flash -->
  <script>
    // Immediately set the theme before any content renders
    (function() {
      const storedTheme = localStorage.getItem('theme');
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      
      if (storedTheme === 'dark') {
        document.documentElement.dataset.theme = 'dark';
      } else if (storedTheme === 'light') {
        document.documentElement.dataset.theme = 'light';
      } else {
        // System preference
        document.documentElement.dataset.theme = prefersDarkScheme.matches ? 'dark' : 'light';
      }
    })();
  </script>
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Sometype+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Favicon -->
  <link rel="icon" href="/images/dp.jpeg" type="image/jpeg">
  <link rel="apple-touch-icon" href="/images/dp.jpeg">
  
  
    <meta property="og:image" content="https://shashankmehta.in/images/dp.jpeg" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://shashankmehta.in/images/dp.jpeg" />
  

  
    <meta property="og:title" content="Backup plan on Ubuntu" />
    <meta name="twitter:title" content="Backup plan on Ubuntu">
  

  

  <meta property="og:type" content="article" />
  <meta name="twitter:site" content="@shashankmehta05">
  <meta name="twitter:creator" content="@shashankmehta05">
  <meta name="twitter:url" content="https://shashankmehta.in/archive/2012/backup-plan-on-ubuntu.html">
</head>
<body>
  <div class="container">
    <header class="grid">
  <figure class="profile-image">
    <img src="/images/dp.jpeg" alt="Shashank Mehta">
  </figure>
  <div>
    <h1 class="grid">
      Shashank Mehta
      <button id="theme-toggle" aria-label="Toggle dark/light mode" onclick="toggleTheme()">
  <svg class="light-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
  <svg class="dark-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
  <svg class="system-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
</button>

<script>
  // Helper function to update the button icon based on current theme
  function updateThemeIcon(theme) {
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.setAttribute('data-mode', theme);
  }

  // Initialize theme on page load
  document.addEventListener('DOMContentLoaded', function() {
    const html = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    
    if (savedTheme) {
      // If user has a saved preference, use it
      if (savedTheme !== 'system') {
        html.dataset.theme = savedTheme;
        updateThemeIcon(savedTheme);
      } else {
        // Using system preference
        updateThemeIcon('system');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        html.dataset.theme = prefersDark ? 'dark' : 'light';
      }
    } else {
      // Default to system
      // localStorage.setItem('theme', 'system');
      updateThemeIcon('system');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      html.dataset.theme = prefersDark ? 'dark' : 'light';
    }
  });

  // Toggle theme when button is clicked - alternate between system and opposite manual mode
  function toggleTheme() {
    const html = document.documentElement;

    // Determine current state. We persist it in localStorage (default = "system")
    const current = localStorage.getItem('theme') || 'system';
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    let next;
    
    if (current === 'system') {
      // If in system mode, switch to manual opposite
      next = systemPrefersDark ? 'light' : 'dark';
    } else {
      // If in any manual mode, switch back to system
      next = 'system';
    }

    // Update button icon
    updateThemeIcon(next);

    // Apply the next state
    if (next === 'system') {
      // Follow OS preference – remove manual override
      delete html.dataset.theme;
      // Apply current system preference
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      html.dataset.theme = prefersDark ? 'dark' : 'light';
    } else {
      html.dataset.theme = next;
    }

    // Persist the choice for future visits
    localStorage.setItem('theme', next);
  }
  
  // Listen for system preference changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
    if (!localStorage.getItem('theme') || localStorage.getItem('theme') === 'system') {
      document.documentElement.dataset.theme = event.matches ? 'dark' : 'light';
    }
  });
</script> 
    </h1>
    <nav class="grid">
      <ul>
        <li><a href="/">Home</a></li>
        
        
        <li><a href="https://x.com/shashankmehta05" target="_blank">X/Twitter</a></li>
        <li><a href="https://www.linkedin.com/in/mehta-shashank/" target="_blank">LinkedIn</a></li>
      </ul>
    </nav>
  </div>
  
</header>
<hr />


    <main>
      
<article>
  <nav>
    <a id="back-button" href="/" class="secondary">&larr; Back</a>
  </nav>

  
  <header class="alert alert-warning">
    <strong>⚠️ DRAFT</strong> - This post will not be published in production
  </header>
  

  <header>
    <h1>Backup plan on Ubuntu</h1>
    <time datetime="2012-12-28">December 28, 2012</time>
  </header>

  <div>
    <p>I hate to use backup applications. There, I said it. This is because:</p>
<ol>
<li>Many use proprietary/weird formats for backing up data.</li>
<li>Backing up is <em>always</em> easy and this ease is advertised but recovery has never been easy.</li>
<li>I don't really want to handle the overload of applications settings/features/tools/services whatnots just for a simple backup.</li>
</ol>
<p>Since I use Ubuntu on daily basis, I tried Deja Dup. As advertised, the backup process is painless. Soon I had snapshots of files for last 7 days. But one day when I tried to revert a file to a three day old snapshot the experience turned out to be horrible. It took insane amount of time to revert a 10kB file. If Deja Dup was not using its own format recovery would have been as easy as <code>cp /path/to/backed/up/file /path/to/actual/file</code>. Even when backup softwares don't use their own format, the number of options/settings that they provide are useless for me. I don't need the cruft.</p>
<!-- more -->
<p>Any experienced Linux guy would have realised by now what I'm getting at. When you do remove the cruft what you get is <code>rsync</code> and <code>cron</code>. A bash script is enough to take care of my backing up needs.</p>
<h2>Partition setup</h2>
<h3>Internal (640 GB HDD)</h3>
<ul>
<li>60 GB Windows (ntfs)</li>
<li>20 GB Ubuntu (ext4)</li>
<li>100 GB /home (ext4)</li>
<li>8 GB swap space</li>
<li>410 GB Media drive (ntfs)</li>
</ul>
<h3>External (1TB HDD)</h3>
<ul>
<li>840 GB Exthdd (ntfs)</li>
<li>100 GB Phoenix_backup (encrypted ext4)</li>
</ul>
<img src="/images/posts/backup.png" style="float:right; margin: 0px 5px 10px 20px">
<p>Phoenix_backup is used for backing up /home. I had to use ext4 for *nix permissions which are not supported on ntfs, giving up the option of having this partition accesible on any PC. Documents and Downloads are copied to ntfs partition because I might need these files on a different system also. I'm not backing up TV Series, Movies etc because I don't really care if I lose them. Most of the other files like Photographs, College Study Material etc are stored in the internal 410GB partition and backed up to 840GB Exthdd partition. The very important documents and files are also stored on Dropbox where I have ~20GB free space thanks to referrals and Spacerace!</p>
<p>I also do not really need multiple snapshot system. However this is possible with simple bash script, cron and rsync. Refer to <a href="http://www.mikerubel.org/computers/rsync_snapshots/">this article</a> if you want to setup one. What I have now is a very primitive backup system that satisfies my needs. My only gripe is that I have to deal with two different filesystems, ext4 and ntfs.</p>
<div style="clear:both">&nbsp;</div>
<h3>References</h3>
<ol>
<li>Rsync Snapshots by Mike Rubel <a href="http://www.mikerubel.org/computers/rsync_snapshots/">[link]</a></li>
<li>Linux Hard Disk Encryption With LUKS. <a href="http://www.cyberciti.biz/hardware/howto-linux-hard-disk-encryption-with-luks-cryptsetup-command/">[link]</a></li>
</ol>

  </div>

  <footer>
    <hr />
    <!-- <div class="grid">
      <div class="col">
        <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="">Tweet</a>
        <a href="http://twitter.com/" class="twitter-follow-button" data-show-count="false">Follow @</a>
        <script src="//platform.twitter.com/widgets.js" type="text/javascript"></script>
      </div>
    </div> -->
  </footer>
</article>

    </main>

    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32545112-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  </div>
</body>
</html> 